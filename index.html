<html>
<head>
	<meta charset="UTF-8">
	<title>civil quiz</title>
<style>
body {
	background-color: #ccc;
	font: bold 1.5em sans-serif;
}
ul {margin:0; padding:0;}
li {
	background-color:#aa0; 
	color: #fff;
	list-style:none;
	border: .2em solid white; 
	padding:.5em; 
	margin: .5em;
}
p.question { 
	margin:0.5em; 
	padding: 3em 0.5em;
	background-color:#666; 
}
p.score { 
	margin:0.5em; 
	padding: 0.5em;
	background-color:#666; 
}

</style>
<script src="scripts/jquery-1.10.0.min.js"></script>
<script src="scripts/underscore-min.js"></script>
<script src="scripts/handlebars.js"></script>

<script id="score-template" type="text/x-handlebars-template">
<p class="score">{{correct}} rätt, {{wrong}} fel</p>
</script>

<script id="question-template" type="text/x-handlebars-template">
<p class="question">{{question}}</p>
<ul>
{{#each answers}}
<li id="answer-{{answer}}" data-answer="{{answer}}">{{text}}</li>
{{/each}}
</ul>
</script>

<script>
var questions = [
	{
		question: "Vad bör du elda med inomhus?",
		answers: [
			{answer: "a", text: "Torr ved i lämplig storlek"},
			{answer: "b", text: "Fuktig ved i lämplig storlek"},
			{answer: "c", text: "Torr ved i olämplig storlek"},
			{answer: "d", text: "Torr ved i lämplig storlek"}
		],
		correct:"a"
	},
	{
		question: "Inomhustemperaturen sjunker om vi inte har tillgång till uppvärmning. I ett ordinärt välbyggt småhus med en inomhustemperatur på +21 grader tar det ett antal timmar innan inomhustemperaturen har sjunkit till  +10 grader, förutsatt att utomhustemperaturen är -10 grader. Hur lång tid tar det?",
		answers: [
			{answer: "a", text: "24 timmar"},
			{answer: "b", text: "36 timmar"},
			{answer: "c", text: "48 timmar"},
			{answer: "d", text: "60 timmar"}
		],
		correct: "b"
	}
];
var questionTemplate = Handlebars.compile($("#question-template").html());
var scoreTemplate = Handlebars.compile($("#score-template").html());
var currentQuestion = -1;
var score = {
	correct:0,
	wrong:0
};

$(function() {
	nextQuestion();
});

function renderQuestion(question) {
	var body = $('#question');
	body.empty();
	body.html(questionTemplate(question));
	$('li').on('click', function(event) {
		var clicked = $(this);
		var answer = clicked.data("answer");
		clicked.css("background-color", "#999");
		validateAnswer(question, answer, function(res) {
			if (res.result == "correct") {
				score.correct++;
				clicked.css("background-color", "#6f3");
			} else {
				clicked.css("background-color", "#c30");
				console.log(res)
				$("#answer-" + res.correct).css("background-color", "#6f3");
				score.wrong++;
			}
			renderScore();
			setTimeout(nextQuestion, 2000);
		});
	});
} 

function renderScore() {
	var body = $('#score');
	body.empty();
	body.html(scoreTemplate(score));
}

function validateAnswer(question, answer, callback) {
	if (answer == question.correct) {
		callback({result:"correct"});
	} else {
		callback({result:"wrong", correct:question.correct});
	}
}

function nextQuestion() {
	currentQuestion = (currentQuestion+1)%questions.length;
	renderQuestion(questions[currentQuestion]);
}
</script>


</head>
<body>
	<div id="question"></div>
	<div id="score"></div>
</body>
</html>